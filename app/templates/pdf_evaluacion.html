<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Evaluación {{ ev.folio }}</title>
  <style>
    @page { size: A4; margin: 18mm 16mm 18mm 16mm; }
    body { font-family: "DejaVu Sans", Arial, sans-serif; font-size: 12px; color:#111; }
    h1 { font-size: 18px; margin: 0 0 6mm 0; text-align:center; }
    h2 { font-size: 14px; margin: 10px 0 6px; border-bottom:1px solid #444; }
    .row { display:flex; gap:8px; }
    .col { flex:1; }
    .box { border:1px solid #444; border-radius:4px; padding:6px; }
    .meta { margin-bottom:6mm; }
    table { width:100%; border-collapse:collapse; margin-top:4px; }
    th, td { border:1px solid #444; padding:6px; vertical-align:top; }
    th { background:#f2f2f2; }
    .muted{ color:#555; }
    .signs { display:flex; gap:10px; margin-top:10mm; }
    .sign { flex:1; border:1px solid #444; border-radius:4px; padding:6px; height:40mm; display:flex; flex-direction:column; justify-content:flex-end; }
    .sign img { max-height:26mm; max-width:100%; object-fit:contain; }
    .sign .label{ border-top:1px solid #444; margin-top:4mm; padding-top:2mm; font-size:11px; }
    .footer { margin-top:6mm; font-size:10px; color:#666; text-align:right; }
    .small{ font-size:11px; }
  </style>
</head>
<body>
  <h1>HR-01-F08 R02 · Evaluación de Certificación (SGE)</h1>

  <!-- Datos principales -->
  <div class="meta box">
    <div class="row">
      <div class="col"><strong>Folio:</strong> {{ ev.folio }}</div>
      <div class="col"><strong>Fecha:</strong> {{ now_local }}</div>
      <div class="col"><strong>Estado:</strong> {{ ev.status }}</div>
    </div>
    <div class="row" style="margin-top:4px">
      <div class="col"><strong>Empleado:</strong> {{ resp.get("empleado_nombre","") }}</div>
      <div class="col"><strong>No. Empleado:</strong> {{ resp.get("empleado_numero","") }}</div>
      <div class="col"><strong>Área:</strong> {{ resp.get("area","") }}</div>
      <div class="col"><strong>Puesto:</strong> {{ resp.get("puesto","") }}</div>
    </div>
  </div>

  <!-- Matriz de evaluación (ejemplo genérico de ítems) -->
  <h2>Resultados</h2>
  <table class="small">
    <thead>
      <tr>
        <th style="width:55%">Criterio / Actividad</th>
        <th style="width:15%">Cumple</th>
        <th style="width:15%">No cumple</th>
        <th style="width:15%">N/A</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.label }}</td>
        {% set v = resp.get(item.key, "") %}
        <td style="text-align:center;">{% if v == "Cumple" %}✔{% endif %}</td>
        <td style="text-align:center;">{% if v == "No cumple" %}✔{% endif %}</td>
        <td style="text-align:center;">{% if v == "N/A" %}✔{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Observaciones -->
  <h2>Observaciones</h2>
  <div class="box" style="min-height:24mm;">
    {{ resp.get("observaciones","") }}
  </div>

  <!-- Acciones correctivas / plan -->
  <h2>Acciones / Plan</h2>
  <div class="box" style="min-height:24mm;">
    {{ resp.get("plan_accion","") }}
  </div>

  <!-- Firmas -->
  <h2>Firmas</h2>
  <div class="signs">
    {% for role in sign_roles %}
      {% set s = signs_map.get(role) %}
      <div class="sign">
        {% if s and s.image_path %}
          <img src="file://{{ s.image_path }}" alt="Firma {{ role }}">
        {% endif %}
        <div class="label">
          <strong>{{ role|capitalize }}</strong><br>
          <span class="muted">{{ s.signer_name if s else "" }}</span>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="footer">
    Generado: {{ now_local }} · Sistema de Evaluación
  </div>
</body>
</html>
